# AbstractObserver ‚Äî llms-full

> Expanded context for LLM agents: `llms.txt` + core docs + selected config/entrypoint files. Source of truth remains the code.

Generated by `scripts/generate-llms-full.mjs` ‚Äî do not edit by hand.

How to use:
- Start with `llms.txt` for a concise map.
- Search within this file for `## <path>` sections to jump to details.
- After doc/code changes, regenerate with `npm run llms:full`.

This file intentionally embeds docs and small, high-signal project files. For large source files, follow links in `llms.txt`.


## llms.txt

# AbstractObserver

> Gateway-only observability UI (Web/PWA) for AbstractFramework runs: a browser SPA + tiny Node.js CLI that connects to an AbstractGateway HTTP API (HTTP fetch + SSE ledger streaming) and submits durable commands.

This repository is UI-only:
- The packaged CLI (`bin/cli.js`) serves static assets from `dist/` (SPA fallback) and does **not** proxy `/api`.
- The browser talks to the gateway via `src/lib/gateway_client.ts` (treat this file as the source of truth for HTTP endpoints and request shapes).

## Quickstart
- Run packaged UI server (no build step): `npx --yes --package @abstractframework/observer -- abstractobserver`
- Dev server (Vite; proxies `/api` in dev): `npm install && npm run dev`
- Unit tests (Vitest): `npm test`
- Production build (writes `dist/`): `npm run build`
- Regenerate `llms-full.txt`: `npm run llms:full`

Notes:
- Build output lives in `dist/` and is served by `bin/cli.js` (don‚Äôt edit `dist/` manually).
- Dev/build uses Vite aliases to sibling workspace packages under `../abstractuic/*/src` (see `vite.config.ts` and `docs/development.md`).
- `llms.txt` format reference: https://llmstxt.org/

## Documentation (start here)
- [README](README.md): Install and quickstart
- [Getting started](docs/getting-started.md): Run the UI and connect to a gateway
- [FAQ](docs/faq.md): Common questions (grounded in code)
- [Docs index](docs/README.md): What to read next
- [Architecture](docs/architecture.md): Components, data flow, diagrams
- [Configuration](docs/configuration.md): CLI env vars, UI settings, deployment patterns
- [API](docs/api.md): Gateway endpoints used by the UI (grounded in code)
- [Development](docs/development.md): Local dev, workspace deps, tests, build
- [Security](docs/security.md): Trust boundaries and operational guidance
- [Troubleshooting](docs/troubleshooting.md): Common issues and fixes

## Key entrypoints (code)
- [CLI server](bin/cli.js): static server (`PORT`, `HOST`), SPA fallback, optional GPU widget config injection
- [App shell + pages](src/ui/app.tsx): settings, page routing, observe/launch flows, durable commands
- [Gateway client](src/lib/gateway_client.ts): HTTP client + SSE ledger streaming (API source of truth)
- [Vite config](vite.config.ts): workspace aliases + dev `/api` proxy
- [Package metadata](package.json): npm name/version, scripts, Node engine
- [llms-full generator](scripts/generate-llms-full.mjs): defines which files are embedded into `llms-full.txt`

## Ecosystem context
- [AbstractFramework](https://github.com/lpalbou/AbstractFramework): ecosystem entrypoint and component map
- [AbstractRuntime](https://github.com/lpalbou/abstractruntime): durable workflow runtime behind the gateway ledger
- [AbstractCore](https://github.com/lpalbou/abstractcore): unified LLM + tools layer commonly used by workflows

## Common tasks
- Add/change a gateway capability: update `src/lib/gateway_client.ts` (source of truth) ‚Üí update `docs/api.md` ‚Üí run `npm test` + `npm run build`.
- Change CLI behavior/config: update `bin/cli.js` ‚Üí update `docs/configuration.md` ‚Üí run `npm run build`.
- Update docs for agents: edit docs ‚Üí regenerate `llms-full.txt` with `npm run llms:full`.

## Optional (project meta)
- [Changelog](CHANGELOG.md): Release notes
- [Contributing](CONTRIBUTING.md): How to develop and submit changes
- [Security policy](SECURITY.md): Responsible vulnerability reporting
- [Acknowledgments](ACKNOWLEDMENTS.md): Credits
- [License](LICENSE): MIT license

---


## README.md

# AbstractObserver

Gateway-only observability UI (Web/PWA) for AbstractFramework runs.

What it does (implemented in `src/ui/app.tsx` + `src/lib/gateway_client.ts`):
- **Discover** workflows/bundles exposed by an AbstractGateway
- **Launch** or **schedule** runs (durable)
- **Observe** runs by replaying + streaming the durable **ledger** (replay-first + SSE)
- **Control** runs via durable commands (`pause`, `resume`, `cancel`)
- (Optional) **Voice** in run chat: gateway-based TTS + push-to-talk transcription (`src/ui/use_gateway_voice.ts`)

## Where it fits (AbstractFramework ecosystem)
AbstractObserver is one of the browser UIs in the **AbstractFramework** ecosystem:
- AbstractFramework (ecosystem entrypoint): https://github.com/lpalbou/AbstractFramework
- AbstractRuntime (durable runtime + ledger behind the gateway): https://github.com/lpalbou/abstractruntime
- AbstractCore (LLM + tools integration used by runtime/workflows): https://github.com/lpalbou/abstractcore

```mermaid
flowchart LR
  U[User] --> O[AbstractObserver<br/>browser UI]
  O -->|HTTP fetch + SSE| G[AbstractGateway<br/>/api/gateway/*]
  G --> R[AbstractRuntime<br/>durable runs + append-only ledger]
  R --> C[AbstractCore<br/>LLM + tools (optional)]
```

## Quickstart (npm)
Prereqs:
- Node.js `>=18`
- An AbstractGateway that exposes the endpoints listed in `docs/api.md`

Run the UI server:
```bash
npx --yes --package @abstractframework/observer -- abstractobserver
```

Note: the npm package is `@abstractframework/observer`, and the CLI binary is `abstractobserver`.

Open `http://localhost:3001`, then go to **Settings** and configure:
- **Gateway URL** (usually your gateway base URL, e.g. `http://localhost:8081`)
  - Leave it blank only for same-origin deployments (reverse proxy routes `/api`) or when using `npm run dev` (Vite `/api` proxy).
- optional **Auth token**, then click **Connect**

## Install options
### Global install
```bash
npm install -g @abstractframework/observer
abstractobserver
```

### Pin a version (recommended for deployments)
```bash
npx --yes --package @abstractframework/observer@0.1.6 -- abstractobserver
```

### CLI configuration
The CLI is a static file server implemented in `bin/cli.js`.
- `PORT` (default `3001`)
- `HOST` (default `0.0.0.0`)
- `--monitor-gpu` or `ABSTRACTOBSERVER_MONITOR_GPU=on` (enables the optional GPU widget)

## Features (UI pages)
All pages share the same gateway connection settings.

- **Observe**: ledger, graph, digest, attachments, chat (optional voice: PTT + TTS)
- **Launch**: start runs, schedule runs, bundle upload/reload
- **Mindmap**: knowledge-graph query UI (requires `POST /api/gateway/kg/query`)
- **Backlog / Inbox (reports + email) / Processes**: maintainer tooling (high trust; requires additional gateway endpoints)

## Documentation
- Start here: `docs/getting-started.md`
- Docs index: `docs/README.md`
- FAQ: `docs/faq.md`
- Architecture (with diagrams): `docs/architecture.md`
- Configuration & deployment: `docs/configuration.md`
- API (gateway endpoints used): `docs/api.md`
- Development: `docs/development.md`
- Security & trust boundaries: `docs/security.md`

## Project
- Changelog: `CHANGELOG.md`
- Contributing: `CONTRIBUTING.md`
- Security policy (vulnerability reporting): `SECURITY.md`
- Acknowledgments: `ACKNOWLEDMENTS.md`

## Development (from source)
```bash
npm install
npm run dev
```

Important: dev/build expects sibling ‚ÄúAbstractUIC‚Äù source packages because `vite.config.ts` aliases imports to `../abstractuic/*/src`.
See `docs/development.md` for details.

---


## package.json

{
  "name": "@abstractframework/observer",
  "version": "0.1.6",
  "description": "Gateway-only observability UI for AbstractFramework - connect to a Run Gateway, replay/stream the ledger, and submit durable commands",
  "type": "module",
  "author": "Laurent-Philippe Albou",
  "license": "MIT",
  "keywords": [
    "abstractframework",
    "observability",
    "workflow",
    "gateway",
    "ui",
    "pwa",
    "monitoring"
  ],
  "repository": {
    "type": "git",
    "url": "https://github.com/lpalbou/abstractobserver.git"
  },
  "homepage": "https://github.com/lpalbou/abstractobserver#readme",
  "publishConfig": {
    "access": "public"
  },
  "bin": {
    "abstractobserver": "./bin/cli.js"
  },
  "files": [
    "dist",
    "bin",
    "README.md"
  ],
  "scripts": {
    "dev": "vite --host --port 3001",
    "build": "tsc && vite build",
    "preview": "vite preview",
    "start": "node ./bin/cli.js",
    "test": "vitest run",
    "llms:full": "node ./scripts/generate-llms-full.mjs",
    "prepublishOnly": "npm run build"
  },
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "reactflow": "^11.10.4"
  },
  "devDependencies": {
    "@types/react": "^18.2.48",
    "@types/react-dom": "^18.2.18",
    "@vitejs/plugin-react": "^4.7.0",
    "typescript": "^5.3.3",
    "vite": "^6.4.1",
    "vitest": "^3.2.4"
  },
  "engines": {
    "node": ">=18.0.0"
  }
}

---


## bin/cli.js

#!/usr/bin/env node

/**
 * CLI entry point for AbstractObserver
 * Serves the built web application on a configurable port
 */

import { createServer } from 'http';
import { readFileSync, existsSync, statSync } from 'fs';
import { join, extname, dirname } from 'path';
import { fileURLToPath } from 'url';

const __dirname = dirname(fileURLToPath(import.meta.url));
const DIST_DIR = join(__dirname, '..', 'dist');
const PORT = process.env.PORT || 3001;
const HOST = process.env.HOST || '0.0.0.0';
const ARGV = process.argv.slice(2);
const MONITOR_GPU =
  ARGV.includes("--monitor-gpu") ||
  ["1", "true", "yes", "on"].includes(String(process.env.ABSTRACTOBSERVER_MONITOR_GPU || "").trim().toLowerCase());

// MIME types for common file extensions
const MIME_TYPES = {
  '.html': 'text/html',
  '.js': 'application/javascript',
  '.css': 'text/css',
  '.json': 'application/json',
  '.png': 'image/png',
  '.jpg': 'image/jpeg',
  '.jpeg': 'image/jpeg',
  '.gif': 'image/gif',
  '.svg': 'image/svg+xml',
  '.ico': 'image/x-icon',
  '.webmanifest': 'application/manifest+json',
};

function getMimeType(filePath) {
  const ext = extname(filePath).toLowerCase();
  return MIME_TYPES[ext] || 'application/octet-stream';
}

function inject_config_html(html) {
  if (!MONITOR_GPU) return html;
  const marker = "window.__ABSTRACT_UI_CONFIG__";
  if (html.includes(marker)) return html;
  const snippet = `<script>${marker}=Object.assign(${marker}||{}, { monitor_gpu: true });</script>`;
  if (html.includes("</head>")) return html.replace("</head>", `${snippet}\n</head>`);
  if (html.includes("</body>")) return html.replace("</body>", `${snippet}\n</body>`);
  return `${html}\n${snippet}\n`;
}

function serveFile(res, filePath) {
  try {
    if (!existsSync(filePath) || !statSync(filePath).isFile()) {
      return false;
    }
    const mimeType = getMimeType(filePath);

    if (mimeType === "text/html") {
      const html = readFileSync(filePath, "utf8");
      const content = inject_config_html(html);
      res.writeHead(200, {
        "Content-Type": `${mimeType}; charset=utf-8`,
        "Cache-Control": "no-cache",
      });
      res.end(content);
      return true;
    }

    const content = readFileSync(filePath);
    res.writeHead(200, {
      'Content-Type': mimeType,
      'Cache-Control': 'no-cache',
    });
    res.end(content);
    return true;
  } catch (err) {
    return false;
  }
}

const server = createServer((req, res) => {
  // Remove query strings and normalize path
  const url = new URL(req.url, `http://${req.headers.host}`);
  let pathname = url.pathname;
  
  // Security: prevent directory traversal
  if (pathname.includes('..')) {
    res.writeHead(400);
    res.end('Bad Request');
    return;
  }

  // Try to serve the requested file
  let filePath = join(DIST_DIR, pathname);
  
  if (serveFile(res, filePath)) {
    return;
  }

  // Try with .html extension
  if (serveFile(res, filePath + '.html')) {
    return;
  }

  // Try index.html in directory
  if (serveFile(res, join(filePath, 'index.html'))) {
    return;
  }

  // SPA fallback: serve index.html for all other routes
  const indexPath = join(DIST_DIR, 'index.html');
  if (serveFile(res, indexPath)) {
    return;
  }

  // If nothing works, return 404
  res.writeHead(404);
  res.end('Not Found');
});

server.listen(PORT, HOST, () => {
  console.log(`
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë         AbstractObserver is running!               ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

  üåê Local:   http://localhost:${PORT}
  üåê Network: http://${HOST}:${PORT}

  üì° Connect to your AbstractGateway instance
  üöÄ Start observing your workflows

  Press Ctrl+C to stop
`);
});

process.on('SIGINT', () => {
  console.log('\n\nüëã Shutting down AbstractObserver...\n');
  process.exit(0);
});

process.on('SIGTERM', () => {
  console.log('\n\nüëã Shutting down AbstractObserver...\n');
  process.exit(0);
});

---


## vite.config.ts

import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";
import { resolve } from "path";

export default defineConfig({
  plugins: [react()],
  resolve: {
    alias: [
      // Workspace imports (AbstractUIC packages) originate outside this project's
      // directory tree, so pin `reactflow` explicitly for both TS and Vite.
      { find: /^reactflow$/, replacement: resolve(__dirname, "./node_modules/reactflow/dist/esm/index.mjs") },
      { find: /^reactflow\/dist\/style\.css$/, replacement: resolve(__dirname, "./node_modules/reactflow/dist/style.css") },
      { find: /^reactflow\/dist\/base\.css$/, replacement: resolve(__dirname, "./node_modules/reactflow/dist/base.css") },

      { find: "@abstractuic/monitor-active-memory", replacement: resolve(__dirname, "../abstractuic/monitor-active-memory/src") },
      { find: "@abstractuic/monitor-flow", replacement: resolve(__dirname, "../abstractuic/monitor-flow/src") },
      { find: "@abstractuic/panel-chat", replacement: resolve(__dirname, "../abstractuic/panel-chat/src") },
      { find: "@abstractuic/ui-kit", replacement: resolve(__dirname, "../abstractuic/ui-kit/src") },
      { find: "@abstractutils/monitor-gpu", replacement: resolve(__dirname, "../abstractuic/monitor-gpu/src") },

      // Support published package names too (some shared packages import each other
      // via @abstractframework/* even when apps use @abstractuic/* workspace aliases).
      { find: "@abstractframework/monitor-active-memory", replacement: resolve(__dirname, "../abstractuic/monitor-active-memory/src") },
      { find: "@abstractframework/monitor-flow", replacement: resolve(__dirname, "../abstractuic/monitor-flow/src") },
      { find: "@abstractframework/panel-chat", replacement: resolve(__dirname, "../abstractuic/panel-chat/src") },
      { find: "@abstractframework/ui-kit", replacement: resolve(__dirname, "../abstractuic/ui-kit/src") },
      { find: "@abstractframework/monitor-gpu", replacement: resolve(__dirname, "../abstractuic/monitor-gpu/src") },
    ],
  },
  server: {
    host: "0.0.0.0",
    allowedHosts: true,
    strictPort: false,
    cors: true,
    fs: {
      // Vite blocks serving files outside an allowlist. When we customize it to
      // include shared workspace packages (e.g. AbstractUIC), we must also include
      // this app's own root directory or Vite will 403 on `/index.html`.
      allow: [resolve(__dirname), resolve(__dirname, "../abstractuic")],
    },
    // In dev, you can proxy /api to a local gateway host (AbstractFlow backend).
    proxy: {
      "/api": {
        target: "http://localhost:8081",
        changeOrigin: true,
        ws: true,
        secure: false,
      },
    },
  },
  build: {
    outDir: "dist",
    sourcemap: true,
  },
});

---


## CHANGELOG.md

# Changelog

## Unreleased
- Docs: align npm install/run commands with the scoped package name (`@abstractframework/observer`) and refresh core docs for ecosystem context and voice endpoints.

## 0.1.6 (2026-02-05)
- Package: publish as `@abstractframework/observer` (CLI binary remains `abstractobserver`).
- UI: Mindmap: layout toolbar (algorithm + spread + apply + force simulation play/pause), Search KG panel is inside the canvas, and blank/offscreen views auto-recover.
- UI: Chat: unify chat UX (cards + composer) across Backlog ‚Üí Advisor and Observe ‚Üí Chat (shared `@abstractuic/panel-chat` styling).
- UI: Voice: gateway-based TTS + push-to-talk transcription (matches AbstractCode) and available in Observe ‚Üí Chat and Backlog ‚Üí Advisor.

## 0.1.4 (2026-02-04)
- Docs: refresh documentation for public release (README, getting started, docs index, API contract, FAQ).
- Docs: add security policy (`SECURITY.md`), contributing guide, and acknowledgments.
- Docs: align `llms.txt` with the `llms.txt` spec and keep `llms-full.txt` in sync.
- UI: align theme with AbstractFlow (tokens, typography, inputs/buttons, scrollbars).
- UI: new header with status pills; run picker and ledger cards use clearer labels + relative time.
- UI: digest and chat timestamps use relative time (falls back to date after 3d).
- Fix: Mindmap UI: resilient render (auto-recovers blank/offscreen view), legend toggle in graph controls, minimap toggle near the preview, and timeline reaches the latest snapshot.
- Tests: `npm test`
- Build: `npm run build`

## 0.1.3 (2026-01-11)
- UI: Digest stays up to date and includes per-subflow stats (polls discovered subrun ledgers).
- UI: Digest adds a ledger-based SUMMARY section with Generate/Regenerate and an ‚Äúoutdated‚Äù indicator.

## 0.1.2 (2026-01-11)
- UI: run picker dropdown is wider and viewport-safe (opens up when needed; never clipped).
- UI: ‚ÄúExisting Runs‚Äù shows only parent runs (filters out subruns) and uses the improved run picker.

## 0.1.1 (2026-01-11)
- UI: replace bundle-info block with a single **Start Workflow** primary action (modal-based start).
- UI: simplify Run controls (run picker + refresh; pause/resume; cancel).
- UI: upgrade run picker to a badge-based, aligned list (readable + status color coding).
- UI: move Remote Tool Worker (MCP) settings into the Start Workflow modal (advanced).
- Docs: add `abstractobserver/docs/architecture.md` and link it from the framework architecture overview.

## 0.1.0
- Initial release.

---


## CONTRIBUTING.md

# Contributing

Thanks for your interest in improving AbstractObserver.

If you‚Äôre unsure where to start, open an issue describing what you want to do ‚Äî we‚Äôre happy to help you shape a good PR.

## Development quickstart
Prereqs:
- Node.js `>=18`
- npm

```bash
npm install
npm test
npm run dev
```

Build the production bundle (served by the CLI):
```bash
npm run build
```

## Workspace dependencies (important)
This repo‚Äôs dev/build configuration aliases several `@abstractuic/*` imports to sibling workspace paths under `../abstractuic/*/src` (see `vite.config.ts`).

If you only cloned this repo, you can either:
1) check out the expected sibling repos under `../abstractuic`, or
2) replace the Vite aliases and add proper package dependencies (if/when those packages are published).

Details: `docs/development.md`.

## Documentation changes
We treat docs as user-facing product surface.
When you change behavior or configuration:
- update the relevant docs under `docs/`
- keep language concise and actionable
- when practical, reference the implementing file(s) (source of truth)
- regenerate `llms-full.txt` with `npm run llms:full` (keeps agent context in sync)

Docs entrypoint: `README.md` ‚Üí `docs/getting-started.md` ‚Üí `docs/README.md`.

## Pull request checklist
- Scope: small and focused (avoid drive-by refactors)
- Quality: `npm test` passes
- Release readiness (if applicable): `npm run build` passes
- Docs: updated if you changed UX, config, or API usage

## Reporting security issues
Please do **not** open public issues for suspected vulnerabilities.
See `SECURITY.md` for responsible disclosure instructions.

---


## SECURITY.md

# Security policy

We take security seriously and appreciate responsible disclosure.

## Reporting a vulnerability
Please **do not** open a public GitHub issue for a suspected vulnerability.

Preferred reporting channel:
- **GitHub Security Advisories** (private): go to the repository‚Äôs **Security** tab and use **Report a vulnerability**.

If Security Advisories are not available for this repo:
- Open a GitHub issue with **minimal details** (no proof-of-concept, no sensitive config), and ask for a private channel.

## What to include
To help us triage quickly, please include:
- a clear description of the impact
- steps to reproduce (or a minimal PoC shared privately)
- affected versions / commit SHA
- any suggested mitigations or patches

## Coordinated disclosure
We‚Äôll work with you to confirm the issue, ship a fix, and coordinate disclosure timing.

## Scope notes
AbstractObserver includes optional **high-trust** capabilities (process control, remote tool execution) depending on what your gateway exposes.
Operational guidance for these features: `docs/security.md`.

---


## ACKNOWLEDMENTS.md

# Acknowledgments

AbstractObserver stands on the shoulders of many open-source projects and the people who maintain them.

## Open-source projects
Direct runtime dependencies (see `package.json#dependencies`):
- React
- React DOM
- React Flow

Build/test tooling (see `package.json#devDependencies`):
- Vite (+ `@vitejs/plugin-react`)
- TypeScript
- Vitest
- `@types/react`, `@types/react-dom`

Documentation uses Mermaid diagrams (rendered by compatible Markdown viewers).

## Community
Thanks to everyone who reports bugs, proposes improvements, and contributes code and documentation.

---


## LICENSE

MIT License

Copyright (c) 2026 Laurent-Philippe Albou

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

---


## docs/README.md

# Documentation

Welcome! These docs are written for **users and deployers** of AbstractObserver.
The **source of truth is the code** (not the docs); where relevant we point to the implementing files.

## Start here
1) `getting-started.md` ‚Äî run the UI and connect to a gateway
2) `faq.md` ‚Äî common questions and gotchas

## I want to‚Ä¶
- **Run the UI locally** ‚Üí `getting-started.md`
- **Deploy behind a reverse proxy (same-origin)** ‚Üí `configuration.md` (recommended pattern)
- **Connect to a remote gateway (cross-origin/CORS)** ‚Üí `configuration.md` + `troubleshooting.md`
- **See which gateway endpoints are required for each UI feature** ‚Üí `api.md`
- **Understand how replay-first + SSE streaming works** ‚Üí `architecture.md`
- **Troubleshoot common browser/network issues** ‚Üí `troubleshooting.md`
- **Understand trust boundaries (process control, MCP worker, tokens)** ‚Üí `security.md`
- **Contribute changes** ‚Üí `../CONTRIBUTING.md`

## Core concepts
- `architecture.md` ‚Äî component view + data flow diagrams
- `api.md` ‚Äî AbstractGateway endpoints used by the UI (grounded in `src/lib/gateway_client.ts`)
- Project + ecosystem overview: `../README.md` (AbstractFramework / AbstractRuntime / AbstractCore)

## Operate and extend
- `configuration.md` ‚Äî CLI env vars, UI settings, deployment patterns
- `security.md` ‚Äî trust boundaries (process manager, remote tool worker, cross-origin)
- `troubleshooting.md` ‚Äî common issues (CORS, mixed content, stale service worker, blank Gateway URL)
- `development.md` ‚Äî run from source, tests, build (includes workspace dependency notes)

## Project meta
- Changelog: `../CHANGELOG.md`
- Contributing: `../CONTRIBUTING.md`
- Security policy (vulnerability reporting): `../SECURITY.md`
- Acknowledgments: `../ACKNOWLEDMENTS.md`
- License: `../LICENSE`

---


## docs/getting-started.md

# Getting started

AbstractObserver is a **gateway-only** observability UI (Web/PWA) for AbstractFramework runs.
It serves a static single-page app (`dist/`) via a small Node.js CLI (`bin/cli.js`) and talks to an AbstractGateway HTTP API from the browser (`src/lib/gateway_client.ts`).

## Prerequisites
- Node.js `>=18`
- A running **AbstractGateway** (base URL, e.g. `http://localhost:8081`)
- (Optional) a gateway auth token (sent as `Authorization: Bearer ‚Ä¶`)

## Run AbstractObserver
The npm package is `@abstractframework/observer` and the installed CLI binary is `abstractobserver`.

Run the packaged UI server (no build step):
```bash
npx --yes --package @abstractframework/observer -- abstractobserver
```

By default the server listens on `0.0.0.0:3001` (see `bin/cli.js`). To bind to localhost only:
```bash
HOST=127.0.0.1 PORT=3001 npx --yes --package @abstractframework/observer -- abstractobserver
```

Open `http://localhost:3001`.

## Connect to a gateway
In **Settings ‚Üí Gateway** (implemented in `src/ui/app.tsx`):
- **Gateway URL**: set it to your gateway base URL (for local dev commonly `http://localhost:8081`).
  - Leave it **blank** only if you deploy the UI and gateway **same-origin** (a reverse proxy routes `/api` to the gateway), or when using `npm run dev` (Vite dev proxy; see `vite.config.ts`).
- **Gateway token**: optional.

Click **Connect** (or keep **Auto-connect** enabled).

If you run the CLI server and leave Gateway URL blank, the UI will call `/api/...` on the UI origin ‚Äî the CLI does **not** proxy `/api` (same-origin requires a reverse proxy).

## Observe a run
Go to **Observe**:
- pick a run from **Runs**
- inspect:
  - **Ledger** (durable log; replay-first + streaming)
  - **Graph** (flow visualization from bundle/workflow flow data)
  - **Digest** (derived stats + summary)
  - **Chat** (run-scoped chat; optional voice PTT + TTS when the gateway exposes the endpoints in `api.md`)

Architecture and data flow: `architecture.md`.

## Launch or schedule a run
Go to **Launch**:
- select a workflow (discovered from gateway bundles)
- click **Start Workflow** (or schedule via the cadence section)

The UI uses `POST /api/gateway/runs/start` and `POST /api/gateway/runs/schedule` (see `src/lib/gateway_client.ts` and `api.md`).

## Next
- Docs index: `README.md`
- FAQ: `faq.md`
- Configuration & deployment: `configuration.md`
- Gateway endpoints used by the UI: `api.md`
- Security & trust boundaries: `security.md`
- Development (from source): `development.md`
- Troubleshooting: `troubleshooting.md`

---


## docs/faq.md

# FAQ

> Last updated: 2026-02-09

## What is AbstractObserver?
AbstractObserver is a **gateway-only** observability UI (Web/PWA) for AbstractFramework runs:
- it runs in the browser (`src/ui/app.tsx`)
- it fetches/streams run data from an AbstractGateway (`src/lib/gateway_client.ts`)
- it serves the built SPA from `dist/` via a small Node.js CLI (`bin/cli.js`)

## Does AbstractObserver execute workflows?
No. It is a UI client. Execution happens behind the gateway.

Evidence:
- the browser talks to the gateway via HTTP/SSE (`src/lib/gateway_client.ts`)
- the CLI only serves static files + SPA fallback (`bin/cli.js`)

## What do I need to use it?
- Node.js `>=18` (see `../package.json`, field `engines`)
- an AbstractGateway that implements the endpoints the UI calls (see `api.md`)

## How do I run it?
```bash
npx --yes --package @abstractframework/observer -- abstractobserver
```

For other install options and CLI flags/env vars, see `../README.md` and `configuration.md`.

## Why is the npm package name different from the CLI command?
The published npm package is scoped (`@abstractframework/observer`), but the installed CLI binary is `abstractobserver`.

Examples:
- no global install: `npx --yes --package @abstractframework/observer -- abstractobserver`
- global install: `npm install -g @abstractframework/observer && abstractobserver`

## How do I change the port / host?
The packaged CLI reads:
- `PORT` (default `3001`)
- `HOST` (default `0.0.0.0`)

Evidence: `bin/cli.js`.

## Does the CLI proxy `/api` to my gateway?
No. The CLI is a static server for `dist/` (it does not forward `/api`).

If you leave **Gateway URL** blank, the UI will call `/api/...` on the UI origin. That only works when:
- you are in dev (`npm run dev`), because Vite proxies `/api` (see `vite.config.ts`), or
- you deploy behind a reverse proxy that routes `/api` to the gateway.

Evidence: `bin/cli.js` (static server), `vite.config.ts` (dev proxy), `src/lib/gateway_client.ts` (fetches `/api/...` when `base_url=""`).

## What should I put in ‚ÄúGateway URL‚Äù?
Usually: your gateway base URL (e.g. `http://localhost:8081` for local dev).

Rules enforced by the UI during discovery (see `on_discover_gateway()` in `src/ui/app.tsx`):
- must start with `http://` or `https://` (or be blank)
- `https://` UI pages cannot call an `http://` gateway (mixed content)
- when the UI is opened from a non-loopback host, `http://localhost:‚Ä¶` is treated as a common misconfiguration (it would resolve on the device, not your gateway machine)

## Do I need CORS?
Only if the UI origin and gateway origin differ.
- Same-origin deployments avoid CORS entirely.
- Cross-origin deployments require the gateway to allow your UI origin and headers.

See `configuration.md`.

## How does authentication work?
If you set a gateway token in Settings, the UI sends:
`Authorization: Bearer <token>`

Evidence: `_auth_headers()` in `src/lib/gateway_client.ts` and Settings storage in `src/ui/app.tsx` (`load_settings()` / `save_settings()`).

Operational guidance: `security.md`.

## What is the ‚Äúledger‚Äù and why ‚Äúreplay-first‚Äù?
The ledger is the durable sequence of step records for a run. The UI:
1) replays history via paged HTTP (`get_ledger()`), then
2) streams new steps via SSE (`stream_ledger()`).

Evidence: `src/lib/gateway_client.ts` and `src/lib/sse_parser.ts`. Diagram: `architecture.md`.

## Which gateway endpoints are required?
It depends on which UI pages/features you use.
For the authoritative list grouped by feature, see `api.md` (grounded in `src/lib/gateway_client.ts`).

## What are Backlog / Inbox / Processes?
They are maintainer-oriented pages that rely on additional gateway endpoints and are **high trust**:
- Backlog: maintenance items (create/edit/execute)
- Inbox: bug/feature reports + triage decisions + email mailbox (list/read/send)
- Processes: process manager controls + log tail

Evidence: `src/ui/backlog_browser.tsx`, `src/ui/report_inbox.tsx`, `src/ui/email_inbox.tsx`, `src/ui/processes_page.tsx`.
Security guidance: `security.md`.

## What is the ‚ÄúRemote tool worker (MCP)‚Äù?
If configured, AbstractObserver can execute tool waits via an MCP HTTP JSON-RPC endpoint and then resume the run.

Evidence:
- worker client: `src/lib/mcp_worker_client.ts`
- UI resume flow: `execute_tools_via_worker()` in `src/ui/app.tsx`

Security guidance: `security.md`.

## Does it support voice (PTT / TTS)?
Yes ‚Äî in **Observe ‚Üí Chat** and **Backlog ‚Üí Advisor**, the UI can:
- record audio in the browser, upload it to the gateway, and request transcription (push-to-talk)
- request gateway-based text-to-speech audio and play it back (TTS)

Gateway endpoints: `api.md` (Voice section).

Evidence:
- voice hook: `src/ui/use_gateway_voice.ts`
- UI wiring: `src/ui/app.tsx`, `src/ui/backlog_browser.tsx`
- gateway client: `src/lib/gateway_client.ts` (`attachments_upload()`, `audio_transcribe()`, `voice_tts()`)

## What is ‚Äúmonitor-gpu‚Äù and how do I enable it?
It‚Äôs an optional GPU usage widget in the header. Enable it by starting the CLI with:
- `abstractobserver --monitor-gpu`, or
- `ABSTRACTOBSERVER_MONITOR_GPU=on`

Evidence:
- HTML config injection: `bin/cli.js`
- UI feature gate: `monitor_gpu_enabled` in `src/ui/app.tsx`

## Is this a PWA? Does it work offline?
The app registers a service worker in production to cache the UI shell (installability + faster reloads), but run data still comes from the gateway.

Evidence: `src/main.tsx`, `public/sw.js`.

## I updated the UI but my browser still shows an old version
Production builds use a service worker; clear site data/unregister the SW if needed.

See `troubleshooting.md`.

## I want to build from source but imports like `@abstractuic/*` fail
Dev/build uses Vite aliases to sibling workspace packages under `../abstractuic/*/src`.

Evidence: `vite.config.ts`. See `development.md`.

## See also
- Getting started: `getting-started.md`
- Docs index: `README.md`
- Architecture: `architecture.md`
- Configuration: `configuration.md`
- API (gateway endpoints used): `api.md`
- Security: `security.md`
- Troubleshooting: `troubleshooting.md`

---


## docs/architecture.md

# AbstractObserver ‚Äî Architecture

> Last updated: 2026-02-09

AbstractObserver is a **gateway-only** UI:
- It **does not execute** workflows.
- It renders state by fetching + streaming a **durable run ledger** from an AbstractGateway.
- It can submit **durable commands** back to the gateway.

The implementation is intentionally simple: a static SPA + typed HTTP client.

## Ecosystem context (AbstractFramework)
AbstractObserver is part of the **AbstractFramework** ecosystem:
- AbstractFramework (ecosystem entrypoint): https://github.com/lpalbou/AbstractFramework
- AbstractRuntime (durable workflow runtime; produces the append-only ledger that the UI renders): https://github.com/lpalbou/abstractruntime
- AbstractCore (LLM + tools integration commonly used by runtime/workflows): https://github.com/lpalbou/abstractcore

AbstractObserver talks only to the **AbstractGateway HTTP API**. The gateway is typically backed by AbstractRuntime (and optional AbstractCore integrations), but those components are not direct dependencies of this UI package.

## Component view (what runs where)
```mermaid
flowchart LR
  U[User] -->|opens| B[Browser / PWA<br/><code>src/ui/app.tsx</code>]
  S[Static UI server<br/><code>bin/cli.js</code>] -->|serves dist/ + SPA fallback| B
  B -->|HTTP fetch + SSE| G[AbstractGateway HTTP API<br/><code>src/lib/gateway_client.ts</code>]
  G -->|backed by| R[AbstractRuntime<br/>durable runs + append-only ledger]
  B -->|optional JSON-RPC over HTTP| W[MCP tool worker<br/><code>src/lib/mcp_worker_client.ts</code>]

  subgraph Notes[Notes]
    N1[Dev: Vite dev server can proxy /api<br/><code>vite.config.ts</code>]
    N2[PWA shell cache via service worker<br/><code>src/main.tsx</code>, <code>public/sw.js</code>]
  end
```

## Core data flow: observe a run (replay ‚Üí stream)
The UI is **replay-first**:
1) page through ledger history; then
2) open an SSE stream and append new records.

```mermaid
sequenceDiagram
  participant UI as Browser UI
  participant GW as AbstractGateway

  UI->>GW: GET /api/gateway/runs/{run_id}
  UI->>GW: GET /api/gateway/runs/{run_id}/ledger?after=0&limit=N (repeat)
  UI->>GW: GET /api/gateway/runs/{run_id}/ledger/stream?after=cursor (SSE)
  GW-->>UI: event: step {"cursor": number, "record": StepRecord}
```

**Evidence in code**
- Replay: `GatewayClient.get_ledger()` in `src/lib/gateway_client.ts`
- Stream: `GatewayClient.stream_ledger()` + `SseParser` in `src/lib/gateway_client.ts` and `src/lib/sse_parser.ts`
- Ledger record shape: `StepRecord` / `LedgerStreamEvent` in `src/lib/types.ts`
- Minimal record interpretation helpers: `src/lib/runtime_extractors.ts`

## UI structure (pages ‚Üí code)
AbstractObserver is a single SPA that stores settings locally and talks to the gateway via `GatewayClient`.

- **Observe** (runs, ledger, graph, digest, attachments, chat): `src/ui/app.tsx`, `src/ui/flow_graph.tsx`, `src/ui/run_picker.tsx`
- **Launch** (start + schedule runs, bundle upload/reload): `src/ui/app.tsx` + `GatewayClient.start_run()` / `schedule_run()`
- **Mindmap** (KG query UI): `src/ui/mindmap_panel.tsx` + `GatewayClient.kg_query()`
- **Backlog** (browse/edit/execute maintenance items): `src/ui/backlog_browser.tsx` + `GatewayClient.backlog_*()`
- **Inbox** (bug/feature reports + triage decisions + email mailbox): `src/ui/report_inbox.tsx` + `src/ui/email_inbox.tsx` + `GatewayClient.list_*_reports()` / `triage_*()` / `email_*()`
- **Processes** (process manager; high trust): `src/ui/processes_page.tsx` + `GatewayClient.list_processes()` / `process_log_tail()` / `*_process()`

## Trust boundaries (important)
AbstractObserver can enable high-trust features depending on what your gateway exposes:
- Process manager endpoints can start/stop/redeploy processes.
- Remote tool execution can be delegated to a client-controlled MCP worker, then resumed into a run via `POST /api/gateway/commands`.

See `security.md` for operational guidance.

## Related docs
- Getting started: `getting-started.md`
- Docs index: `README.md`
- Project overview + install: `../README.md`
- API (gateway endpoints used): `api.md`
- Configuration & deployment: `configuration.md`
- Security & trust boundaries: `security.md`

---


## docs/api.md

# API (AbstractGateway endpoints used by AbstractObserver)

This document lists the **HTTP endpoints AbstractObserver calls**, grouped by feature.
The **source of truth** for paths, query params, and request bodies is `src/lib/gateway_client.ts`.

> Authentication: when configured, the UI sends `Authorization: Bearer <token>` (see `_auth_headers()` in `src/lib/gateway_client.ts`).
>
> Base URL: the UI‚Äôs **Gateway URL** setting is passed as `GatewayClientConfig.base_url`. When blank, requests are same-origin (`/api/...`). Evidence: `_join()` in `src/lib/gateway_client.ts`.

## Minimum endpoints (core Observe + Launch)
Used by `src/ui/app.tsx` for basic discovery, run launch, and run observation.

- **Workflows / bundles**
  - `GET /api/gateway/bundles` ‚Äî list bundles (workflow discovery)
  - `GET /api/gateway/bundles/{bundle_id}` ‚Äî bundle details
  - `GET /api/gateway/bundles/{bundle_id}/flows/{flow_id}` ‚Äî flow graph data (graph rendering + pin inference)
  - `GET /api/gateway/workflows/{workflow_id}/flow` ‚Äî flow graph for a namespaced workflow id (bundle:flow)
- **Runs**
  - `GET /api/gateway/runs?limit=‚Ä¶&status=‚Ä¶&workflow_id=‚Ä¶&session_id=‚Ä¶&root_only=true|false` ‚Äî list recent runs
  - `GET /api/gateway/runs/{run_id}` ‚Äî run state (status, paused, waiting, schedule metadata, etc.)
  - `GET /api/gateway/runs/{run_id}/input_data` ‚Äî inputs used for the run (shown in UI)
  - `POST /api/gateway/runs/start` ‚Äî start a run (body includes `input_data` and optional `bundle_id`, `flow_id`, `session_id`)
  - `POST /api/gateway/runs/schedule` ‚Äî schedule a run (interval/recurrence; body includes `bundle_id`, `flow_id`, `input_data`)
- **Ledger (durable source of truth)**
  - `GET /api/gateway/runs/{run_id}/ledger?after=‚Ä¶&limit=‚Ä¶` ‚Äî paged replay
  - `GET /api/gateway/runs/{run_id}/ledger/stream?after=‚Ä¶` ‚Äî SSE stream of `"step"` events
  - `POST /api/gateway/runs/ledger/batch` ‚Äî fetch ledgers for multiple runs (digest/subrun support)
- **Run control**
  - `POST /api/gateway/commands` ‚Äî submit durable commands (at minimum `pause`, `resume`, `cancel`; also used for schedule updates and wait/tool resume flows)

## Optional endpoints (feature-gated in the UI)
These power additional pages/drawers. If your gateway does not expose them, the corresponding UI areas will show errors or empty states.

- **Gateway discovery helpers**
  - `GET /api/gateway/discovery/tools`
  - `GET /api/gateway/discovery/providers?include_models=true|false`
  - `GET /api/gateway/discovery/providers/{provider}/models`
- **Bundle management**
  - `POST /api/gateway/bundles/reload`
  - `POST /api/gateway/bundles/upload`
  - `DELETE /api/gateway/bundles/{bundle_id}?bundle_version=‚Ä¶&reload=true|false`
- **Knowledge graph (Mindmap page)**
  - `POST /api/gateway/kg/query`
- **Process manager (Processes page; high trust)**
  - `GET /api/gateway/processes`
  - `GET /api/gateway/processes/env` ‚Äî list managed environment variables
  - `POST /api/gateway/processes/env` ‚Äî set/unset managed environment variables
  - `POST /api/gateway/processes/{id}/start|stop|restart|redeploy`
  - `GET /api/gateway/processes/{id}/logs/tail?max_bytes=‚Ä¶`
- **Run artifacts (attachments + saved chat threads)**
  - `GET /api/gateway/runs/{run_id}/artifacts?limit=‚Ä¶`
  - `GET /api/gateway/runs/{run_id}/artifacts/{artifact_id}/content`
- **Run summaries + run-scoped chat**
  - `POST /api/gateway/runs/{run_id}/summary`
  - `POST /api/gateway/runs/{run_id}/chat`
  - `POST /api/gateway/runs/{run_id}/chat_threads` ‚Äî persist a discussion as an artifact
- **Voice (Observe ‚Üí Chat; optional)**
  - `POST /api/gateway/attachments/upload` ‚Äî upload an attachment (used for voice recordings; multipart form with `session_id` + `file`)
  - `POST /api/gateway/runs/{run_id}/audio/transcribe` ‚Äî transcribe an uploaded audio artifact
  - `POST /api/gateway/runs/{run_id}/voice/tts` ‚Äî text-to-speech (returns an audio artifact)
- **Bug/feature inbox + triage**
  - `GET /api/gateway/reports/bugs` / `GET /api/gateway/reports/features`
  - `GET /api/gateway/reports/bugs/{filename}/content` / `‚Ä¶/features/{filename}/content`
  - `POST /api/gateway/triage/run`
  - `GET /api/gateway/triage/decisions?status=‚Ä¶&limit=‚Ä¶`
  - `POST /api/gateway/triage/decisions/{decision_id}/apply`
  - `POST /api/gateway/bugs/report` / `POST /api/gateway/features/report`
- **Email inbox (multi-account)**
  - `GET /api/gateway/email/accounts`
  - `GET /api/gateway/email/messages?account=‚Ä¶&mailbox=‚Ä¶&since=‚Ä¶&status=‚Ä¶&limit=‚Ä¶`
  - `GET /api/gateway/email/messages/{uid}?account=‚Ä¶&mailbox=‚Ä¶&max_body_chars=‚Ä¶`
  - `POST /api/gateway/email/send`
- **Backlog maintenance (Backlog page; high trust)**
  - `GET /api/gateway/backlog/{kind}` (kind = planned/proposed/recurrent/completed/deprecated/trash)
  - `GET /api/gateway/backlog/{kind}/{filename}/content`
  - `POST /api/gateway/backlog/template`
  - `POST /api/gateway/backlog/move`
  - `POST /api/gateway/backlog/{kind}/{filename}/update`
  - `POST /api/gateway/backlog/create`
  - `POST /api/gateway/backlog/{kind}/{filename}/execute?execution_mode=‚Ä¶`
  - `POST /api/gateway/backlog/execute_batch`
  - `POST /api/gateway/backlog/merge`
  - `GET /api/gateway/backlog/exec/config`
  - `GET /api/gateway/backlog/exec/requests?status=‚Ä¶&limit=‚Ä¶`
  - `GET /api/gateway/backlog/exec/requests/{request_id}?include_prompt=true|false`
  - `POST /api/gateway/backlog/exec/requests/{request_id}/feedback`
  - `POST /api/gateway/backlog/exec/requests/{request_id}/promote`
  - `POST /api/gateway/backlog/exec/requests/{request_id}/uat/deploy`
  - `GET /api/gateway/backlog/exec/requests/{request_id}/logs/tail?name=‚Ä¶&max_bytes=‚Ä¶`
  - `GET /api/gateway/backlog/exec/active_items?status=‚Ä¶&limit=‚Ä¶`
  - `POST /api/gateway/backlog/{kind}/{filename}/attachments/upload`
  - `POST /api/gateway/backlog/assist`
  - `POST /api/gateway/backlog/maintain`
  - `POST /api/gateway/backlog/advisor`

## See also
- Docs index: `README.md`
- Getting started: `getting-started.md`
- Architecture: `architecture.md`
- Configuration & deployment: `configuration.md`
- Security & trust boundaries: `security.md`

---


## docs/configuration.md

# Configuration & deployment

This project has two layers of configuration:
1) the **static UI server** (Node.js CLI); and
2) the **browser UI settings** (stored locally in your browser).

## CLI (static server)
Implemented in `bin/cli.js`.

- The npm package is `@abstractframework/observer`; the installed CLI binary is `abstractobserver`.
- If you don‚Äôt want a global install, you can run the CLI via `npx --yes --package @abstractframework/observer -- abstractobserver`.

- `PORT` ‚Äî HTTP port to listen on (default `3001`)
- `HOST` ‚Äî bind address (default `0.0.0.0`)
- `--monitor-gpu` or `ABSTRACTOBSERVER_MONITOR_GPU=1|true|yes|on` ‚Äî injects `window.__ABSTRACT_UI_CONFIG__.monitor_gpu=true` to enable the GPU widget in the UI (`src/ui/app.tsx`)

Examples:
```bash
PORT=8080 abstractobserver
HOST=127.0.0.1 PORT=3001 abstractobserver
abstractobserver --monitor-gpu

# no global install:
HOST=127.0.0.1 PORT=3001 npx --yes --package @abstractframework/observer -- abstractobserver
```

## Browser UI settings (per device/browser)
Implemented in `src/ui/app.tsx` (see `load_settings()` / `save_settings()`).

- **Gateway URL** (`gateway_url`)
  - Blank means **same-origin** (calls `/api/...` on the same host serving the UI).
  - Set it to `http(s)://‚Ä¶` to target a remote gateway.
  - Note: the packaged CLI (`bin/cli.js`) serves static files only. If you leave Gateway URL blank when using the CLI, `/api` must be provided by a reverse proxy.
- **Auth token** (`auth_token`) ‚Äî sent as `Authorization: Bearer ‚Ä¶` to the gateway (see `src/lib/gateway_client.ts`).
- **Remote tool worker** (`worker_url`, `worker_token`) ‚Äî optional MCP JSON-RPC over HTTP endpoint used to execute tool waits (see `src/lib/mcp_worker_client.ts`).
- UI preferences: theme, font scale, header density, auto-connect.

## Deployment patterns (recommended)
### 1) Same-origin (simplest)
Serve the UI and gateway under the same origin, and keep **Gateway URL blank**.
- Pros: no CORS issues; works well behind a reverse proxy.
- Cons: requires routing `/api` to the gateway.

### 2) Cross-origin (gateway on a different host)
Set **Gateway URL** in the UI settings.
- The gateway must allow browser access (CORS, auth, TLS).
- Avoid `http://localhost:‚Ä¶` when accessing from another device; the UI explicitly warns about this in discovery logic (`on_discover_gateway()` in `src/ui/app.tsx`).

## Dev server proxy
In dev (`npm run dev`), Vite proxies `/api` to `http://localhost:8081` by default (see `vite.config.ts`).
If your gateway is elsewhere, update the `server.proxy` section.

## PWA / service worker
- Production builds register a service worker at `/sw.js` to cache the UI shell (see `src/main.tsx` and `public/sw.js`).
- In dev, the app **unregisters** any existing service workers and clears caches to avoid ‚Äústale UI‚Äù behavior (see `src/main.tsx`).

## See also
- Getting started: `getting-started.md`
- FAQ: `faq.md`
- API endpoints used by the UI: `api.md`
- Security & trust boundaries: `security.md`
- Development: `development.md`

---


## docs/development.md

# Development

## Prerequisites
- Node.js `>=18` (see `package.json#engines`)
- npm

## Run from source (local dev)
```bash
npm install
npm run dev
```

### Workspace dependencies (important)
The UI imports several ‚ÄúAbstractUIC‚Äù packages (examples in `src/ui/app.tsx`) and `vite.config.ts` aliases them to local source paths like `../abstractuic/*/src`.

That means `npm run dev` / `npm run build` expect the following to exist **next to** this repo:
- `../abstractuic/monitor-active-memory/src`
- `../abstractuic/monitor-flow/src`
- `../abstractuic/panel-chat/src`
- `../abstractuic/ui-kit/src`
- `../abstractuic/monitor-gpu/src`

If you only cloned `abstractobserver`, you have two options:
1) check out the required sibling repos under `../abstractuic`, or
2) replace the Vite aliases and add proper package dependencies (if/when those packages are published).

## Tests
```bash
npm test
```

Test suite is Vitest (see `vitest.config.cjs`) with unit tests under `src/**.test.ts(x)`.

## Build
```bash
npm run build
```

- Builds the SPA into `dist/` (Vite) and type-checks via `tsc`.
- The published CLI serves `dist/` (see `bin/cli.js`).
- `npm publish` runs `npm run build` via `prepublishOnly` (see `package.json`).

## Useful scripts
- `npm run dev` ‚Äî Vite dev server (defaults to port `3001`; proxies `/api` to `http://localhost:8081` per `vite.config.ts`)
- `npm run preview` ‚Äî preview the production build
- `npm test` ‚Äî run unit tests

## See also
- Getting started: `getting-started.md`
- Configuration & deployment: `configuration.md`
- Architecture: `architecture.md`
- Security & trust boundaries: `security.md`

---


## docs/security.md

# Security & trust boundaries

AbstractObserver is ‚Äújust a UI‚Äù, but it can become **high-trust** depending on what your gateway exposes and which optional features you enable.

## Network exposure (CLI default bind)
The packaged CLI binds to `0.0.0.0` by default (`HOST` in `bin/cli.js`), which can expose the UI on your LAN.

Guidance:
- Prefer `HOST=127.0.0.1` for local development.
- For shared deployments, put the UI behind an authenticated reverse proxy and use HTTPS.

## Tokens and local storage
The UI stores settings in your browser (see `load_settings()` / `save_settings()` in `src/ui/app.tsx`), including:
- gateway auth token (`auth_token`)
- optional MCP worker auth token (`worker_token`)

Operational guidance:
- Treat the browser profile as a secret-bearing environment.
- Prefer private machines and locked-down profiles for production tokens.
- Prefer same-origin deployments and HTTPS to reduce leakage risk.

## Voice features (microphone + uploads)
If you use voice push-to-talk (PTT) or TTS:
- the UI may request **microphone permissions** (PTT) and upload audio recordings to the gateway
- generated TTS audio is downloaded from the gateway as a run artifact

Evidence: `src/ui/use_gateway_voice.ts` and related endpoints in `src/lib/gateway_client.ts` (`attachments_upload()`, `audio_transcribe()`, `voice_tts()`).

## Process manager (high trust)
The **Processes** page (`src/ui/processes_page.tsx`) can call endpoints that start/stop/restart/redeploy services and tail logs.

Guidance:
- Do not expose process-manager endpoints on a public gateway.
- Enforce strong authn/authz and network restrictions.
- Assume ‚Äúwhoever can access the UI + token can control processes‚Äù.

## Remote tool worker (high trust)
If configured, AbstractObserver can execute tool waits via an MCP HTTP worker (`src/lib/mcp_worker_client.ts`) and then resume the run via `POST /api/gateway/commands` (`src/lib/gateway_client.ts`).

Guidance:
- Only point to trusted workers (they can run tools on your behalf).
- Use per-environment tokens and audit logs where possible.
- Prefer running the worker on the same machine/network as the user controlling it.

## Cross-origin + CORS
If the UI origin differs from the gateway origin:
- the gateway must support browser access (CORS, TLS, auth)
- tokens will be sent from the browser to the gateway (and potentially exposed to browser extensions)

Guidance:
- Prefer a reverse proxy so the UI and gateway are same-origin (`configuration.md`).
- If CORS is required, restrict origins and headers; avoid permissive wildcards.

## See also
- Getting started: `getting-started.md`
- FAQ: `faq.md`
- Configuration & deployment: `configuration.md`
- API (gateway endpoints used): `api.md`
- Architecture: `architecture.md`
- Security policy (vulnerability reporting): `../SECURITY.md`

---


## docs/troubleshooting.md

# Troubleshooting

## ‚ÄúGateway URL must start with http:// or https://‚Äù
In Settings ‚Üí Gateway URL, use an absolute URL (including scheme), or leave it blank for same-origin `/api` calls.

Evidence: `on_discover_gateway()` in `src/ui/app.tsx`.

## ‚ÄúMixed content is blocked‚Äù (https page ‚Üí http gateway)
Browsers block `https://` pages from calling `http://` APIs.
- Use an `https://` gateway URL, or
- deploy UI + gateway behind the same `https://` origin (reverse proxy) and leave Gateway URL blank.

Evidence: mixed-content guard in `on_discover_gateway()` in `src/ui/app.tsx`.

## ‚ÄúGateway URL points to localhost ‚Ä¶ from this device is not your machine‚Äù
If you opened the UI from another device (phone, tablet), `localhost` refers to that device, not your gateway host.
- Use the gateway‚Äôs LAN/public URL, or
- use a tunnel (HTTPS) to your local gateway, or
- keep same-origin via a reverse proxy.

Evidence: loopback guard in `on_discover_gateway()` in `src/ui/app.tsx`.

## CORS errors in the browser console
Use same-origin deployment (recommended) or configure CORS on the gateway for your UI origin.
See `configuration.md`.

## Blank Gateway URL + CLI server shows 404s under /api
The packaged CLI (`bin/cli.js`) is a static server and does not proxy `/api`.
- Set **Gateway URL** to your gateway base URL (e.g. `http://localhost:8081`), or
- deploy behind a reverse proxy so the UI and gateway are same-origin and `/api` routes to the gateway.

## Mindmap shows counts but the graph canvas is blank
If Mindmap shows a snapshot count (assertions/nodes/edges) but the canvas looks empty:
- click **fit view** in the graph controls (bottom-left)
- if you previously saved a layout in Mindmap, open **layout ‚Üí Clear saved** (a bad saved viewport can pan you far away)

## Stale UI after updating
Production builds register a service worker (`src/main.tsx`, `public/sw.js`).
If you see stale UI assets:
- hard refresh, or
- clear site data / unregister service worker for the site.

In dev, AbstractObserver automatically unregisters service workers on load (see `src/main.tsx`).

## See also
- Getting started: `getting-started.md`
- FAQ: `faq.md`
- Configuration & deployment: `configuration.md`
- Security & trust boundaries: `security.md`

---
