# AbstractObserver — llms-full

> Combined, LLM-friendly documentation context (README + docs). Source of truth remains the code.

This file complements `llms.txt` by inlining the core docs so an agent can reason about the project without fetching multiple files.

## README.md

# AbstractObserver

Gateway-only observability UI (Web/PWA) for AbstractFramework runs.

What it does (implemented in `src/ui/app.tsx` + `src/lib/gateway_client.ts`):
- **Discover** workflows/bundles exposed by an AbstractGateway
- **Launch** or **schedule** runs (durable)
- **Observe** runs by replaying + streaming the durable **ledger** (replay-first + SSE)
- **Control** runs via durable commands (pause/resume/cancel/resume-wait)

## Quickstart (npm)
Prereqs:
- Node.js `>=18`
- An AbstractGateway that exposes the endpoints listed in `docs/gateway-api.md`

Run the UI server:
```bash
npx abstractobserver
```

Open `http://localhost:3001`, then go to **Settings** and configure:
- **Gateway URL** (usually your gateway base URL, e.g. `http://localhost:8081`)
  - Leave it blank only for same-origin deployments (reverse proxy routes `/api`) or when using `npm run dev` (Vite `/api` proxy).
- optional **Auth token**, then click **Connect**

## Install options
### Global install
```bash
npm install -g abstractobserver
abstractobserver
```

### Pin a version (recommended for deployments)
```bash
npx abstractobserver@0.1.3
```

### CLI configuration
The CLI is a static file server implemented in `bin/cli.js`.
- `PORT` (default `3001`)
- `HOST` (default `0.0.0.0`)
- `--monitor-gpu` or `ABSTRACTOBSERVER_MONITOR_GPU=on` (enables the optional GPU widget)

## Features (UI pages)
All pages share the same gateway connection settings.

- **Observe**: ledger, graph, digest, attachments, chat
- **Launch**: start runs, schedule runs, bundle upload/reload
- **Mindmap**: knowledge-graph query UI (requires `POST /api/gateway/kg/query`)
- **Backlog / Inbox / Processes**: maintainer tooling (high trust; requires additional gateway endpoints)

## Documentation
- Start here: `docs/getting-started.md`
- Architecture (with diagrams): `docs/architecture.md`
- Configuration & deployment: `docs/configuration.md`
- Gateway API contract (endpoints used): `docs/gateway-api.md`
- Development: `docs/development.md`
- Security & trust boundaries: `docs/security.md`

## Development (from source)
```bash
npm install
npm run dev
```

Important: dev/build expects sibling “AbstractUIC” source packages because `vite.config.ts` aliases imports to `../abstractuic/*/src`.
See `docs/development.md` for details.

---

## docs/getting-started.md

# Getting started

AbstractObserver is a **gateway-only** observability UI (Web/PWA) for AbstractFramework runs.
It serves a static single-page app (`dist/`) via a small Node.js CLI (`bin/cli.js`) and talks to an AbstractGateway HTTP API from the browser (`src/lib/gateway_client.ts`).

## Prerequisites
- Node.js `>=18`
- A running **AbstractGateway** (base URL, e.g. `http://localhost:8081`)
- (Optional) a gateway auth token (sent as `Authorization: Bearer …`)

## Run AbstractObserver
Run the packaged UI server (no build step):
```bash
npx abstractobserver
```

By default the server listens on `0.0.0.0:3001` (see `bin/cli.js`). To bind to localhost only:
```bash
HOST=127.0.0.1 PORT=3001 npx abstractobserver
```

Open `http://localhost:3001`.

## Connect to a gateway
In **Settings → Gateway** (implemented in `src/ui/app.tsx`):
- **Gateway URL**: set it to your gateway base URL (for local dev commonly `http://localhost:8081`).
  - Leave it **blank** only if you deploy the UI and gateway **same-origin** (a reverse proxy routes `/api` to the gateway), or when using `npm run dev` (Vite dev proxy; see `vite.config.ts`).
- **Gateway token**: optional.

Click **Connect** (or keep **Auto-connect** enabled).

If you run the CLI server and leave Gateway URL blank, the UI will call `/api/...` on the UI origin — the CLI does **not** proxy `/api` (same-origin requires a reverse proxy).

## Observe a run
Go to **Observe**:
- pick a run from **Runs**
- inspect:
  - **Ledger** (durable log; replay-first + streaming)
  - **Graph** (flow visualization from bundle/workflow flow data)
  - **Digest** (derived stats + summary)

Architecture and data flow: `architecture.md`.

## Launch or schedule a run
Go to **Launch**:
- select a workflow (discovered from gateway bundles)
- click **Start Workflow** (or schedule via the cadence section)

The UI uses `POST /api/gateway/runs/start` and `POST /api/gateway/runs/schedule` (see `src/lib/gateway_client.ts` and `gateway-api.md`).

## Next
- Configuration & deployment: `configuration.md`
- Gateway endpoints used by the UI: `gateway-api.md`
- Security & trust boundaries: `security.md`
- Development (from source): `development.md`
- Troubleshooting: `troubleshooting.md`

---

## docs/architecture.md

# AbstractObserver — Architecture

> Last updated: 2026-02-04

AbstractObserver is a **gateway-only** UI:
- It **does not execute** workflows.
- It renders state by fetching + streaming a **durable run ledger** from an AbstractGateway.
- It can submit **durable commands** back to the gateway.

The implementation is intentionally simple: a static SPA + typed HTTP client.

## Component view (what runs where)
```mermaid
flowchart LR
  U[User] -->|opens| B[Browser / PWA<br/><code>src/ui/app.tsx</code>]
  S[Static UI server<br/><code>bin/cli.js</code>] -->|serves dist/ + SPA fallback| B
  B -->|HTTP fetch + SSE| G[AbstractGateway HTTP API<br/><code>src/lib/gateway_client.ts</code>]
  B -->|optional JSON-RPC over HTTP| W[MCP tool worker<br/><code>src/lib/mcp_worker_client.ts</code>]

  subgraph Notes[Notes]
    N1[Dev: Vite dev server can proxy /api<br/><code>vite.config.ts</code>]
    N2[PWA shell cache via service worker<br/><code>src/main.tsx</code>, <code>public/sw.js</code>]
  end
```

## Core data flow: observe a run (replay → stream)
The UI is **replay-first**:
1) page through ledger history; then
2) open an SSE stream and append new records.

```mermaid
sequenceDiagram
  participant UI as Browser UI
  participant GW as AbstractGateway

  UI->>GW: GET /api/gateway/runs/{run_id}
  UI->>GW: GET /api/gateway/runs/{run_id}/ledger?after=0&limit=N (repeat)
  UI->>GW: GET /api/gateway/runs/{run_id}/ledger/stream?after=cursor (SSE)
  GW-->>UI: event: step {"cursor": number, "record": StepRecord}
```

**Evidence in code**
- Replay: `GatewayClient.get_ledger()` in `src/lib/gateway_client.ts`
- Stream: `GatewayClient.stream_ledger()` + `SseParser` in `src/lib/gateway_client.ts` and `src/lib/sse_parser.ts`
- Ledger record shape: `StepRecord` / `LedgerStreamEvent` in `src/lib/types.ts`
- Minimal record interpretation helpers: `src/lib/runtime_extractors.ts`

## UI structure (pages → code)
AbstractObserver is a single SPA that stores settings locally and talks to the gateway via `GatewayClient`.

- **Observe** (runs, ledger, graph, digest, attachments, chat): `src/ui/app.tsx`, `src/ui/flow_graph.tsx`, `src/ui/run_picker.tsx`
- **Launch** (start + schedule runs, bundle upload/reload): `src/ui/app.tsx` + `GatewayClient.start_run()` / `schedule_run()`
- **Mindmap** (KG query UI): `src/ui/mindmap_panel.tsx` + `GatewayClient.kg_query()`
- **Backlog** (browse/edit/execute maintenance items): `src/ui/backlog_browser.tsx` + `GatewayClient.backlog_*()`
- **Inbox** (bug/feature reports + triage decisions): `src/ui/report_inbox.tsx` + `GatewayClient.list_*_reports()` / `triage_*()`
- **Processes** (dev-only process manager): `src/ui/processes_page.tsx` + `GatewayClient.list_processes()` / `process_log_tail()` / `*_process()`

## Trust boundaries (important)
AbstractObserver can enable high-trust features depending on what your gateway exposes:
- Process manager endpoints can start/stop/redeploy processes.
- Remote tool execution can be delegated to a client-controlled MCP worker, then resumed into a run via `POST /api/gateway/commands`.

See `security.md` for operational guidance.

## Related docs
- Getting started: `getting-started.md`
- Project overview + install: `../README.md`
- Gateway API contract (what the UI calls): `gateway-api.md`
- Configuration & deployment: `configuration.md`
- Security & trust boundaries: `security.md`

---

## docs/gateway-api.md

# AbstractObserver ↔ AbstractGateway API contract

This document lists the **HTTP endpoints AbstractObserver calls**, grouped by feature.
The **source of truth** for paths, query params, and request bodies is `src/lib/gateway_client.ts`.

> Authentication: when configured, the UI sends `Authorization: Bearer <token>` (see `_auth_headers()` in `src/lib/gateway_client.ts`).

## Minimum endpoints (core Observe + Launch)
Used by `src/ui/app.tsx` for basic discovery, run launch, and run observation.

- **Workflows / bundles**
  - `GET /api/gateway/bundles` — list bundles (workflow discovery)
  - `GET /api/gateway/bundles/{bundle_id}` — bundle details
  - `GET /api/gateway/bundles/{bundle_id}/flows/{flow_id}` — flow graph data (graph rendering + pin inference)
  - `GET /api/gateway/workflows/{workflow_id}/flow` — flow graph for a namespaced workflow id (bundle:flow)
- **Runs**
  - `GET /api/gateway/runs?limit=…&status=…&workflow_id=…&session_id=…&root_only=true|false` — list recent runs
  - `GET /api/gateway/runs/{run_id}` — run state (status, paused, waiting, schedule metadata, etc.)
  - `GET /api/gateway/runs/{run_id}/input_data` — inputs used for the run (shown in UI)
  - `POST /api/gateway/runs/start` — start a run (body includes `input_data` and optional `bundle_id`, `flow_id`, `session_id`)
  - `POST /api/gateway/runs/schedule` — schedule a run (interval/recurrence; body includes `bundle_id`, `flow_id`, `input_data`)
- **Ledger (durable source of truth)**
  - `GET /api/gateway/runs/{run_id}/ledger?after=…&limit=…` — paged replay
  - `GET /api/gateway/runs/{run_id}/ledger/stream?after=…` — SSE stream of `"step"` events
  - `POST /api/gateway/runs/ledger/batch` — fetch ledgers for multiple runs (digest/subrun support)
- **Run control**
  - `POST /api/gateway/commands` — submit durable commands (pause/resume/cancel/resume-wait)

## Optional endpoints (feature-gated in the UI)
These power additional pages/drawers. If your gateway does not expose them, the corresponding UI areas will show errors or empty states.

- **Gateway discovery helpers**
  - `GET /api/gateway/discovery/tools`
  - `GET /api/gateway/discovery/providers?include_models=true|false`
  - `GET /api/gateway/discovery/providers/{provider}/models`
- **Bundle management**
  - `POST /api/gateway/bundles/reload`
  - `POST /api/gateway/bundles/upload`
  - `DELETE /api/gateway/bundles/{bundle_id}?bundle_version=…&reload=true|false`
- **Knowledge graph (Mindmap page)**
  - `POST /api/gateway/kg/query`
- **Process manager (Processes page; high trust)**
  - `GET /api/gateway/processes`
  - `POST /api/gateway/processes/{id}/start|stop|restart|redeploy`
  - `GET /api/gateway/processes/{id}/logs/tail?max_bytes=…`
- **Run artifacts (attachments + saved chat threads)**
  - `GET /api/gateway/runs/{run_id}/artifacts?limit=…`
  - `GET /api/gateway/runs/{run_id}/artifacts/{artifact_id}/content`
- **Run summaries + run-scoped chat**
  - `POST /api/gateway/runs/{run_id}/summary`
  - `POST /api/gateway/runs/{run_id}/chat`
  - `POST /api/gateway/runs/{run_id}/chat_threads` — persist a discussion as an artifact
- **Bug/feature inbox + triage**
  - `GET /api/gateway/reports/bugs` / `GET /api/gateway/reports/features`
  - `GET /api/gateway/reports/bugs/{filename}/content` / `…/features/{filename}/content`
  - `POST /api/gateway/triage/run`
  - `GET /api/gateway/triage/decisions?status=…&limit=…`
  - `POST /api/gateway/triage/decisions/{decision_id}/apply`
  - `POST /api/gateway/bugs/report` / `POST /api/gateway/features/report`
- **Backlog maintenance (Backlog page; high trust)**
  - `GET /api/gateway/backlog/{kind}` (kind = planned/proposed/recurrent/completed/deprecated/trash)
  - `GET /api/gateway/backlog/{kind}/{filename}/content`
  - `POST /api/gateway/backlog/template`
  - `POST /api/gateway/backlog/move`
  - `POST /api/gateway/backlog/{kind}/{filename}/update`
  - `POST /api/gateway/backlog/create`
  - `POST /api/gateway/backlog/{kind}/{filename}/execute?execution_mode=…`
  - `POST /api/gateway/backlog/execute_batch`
  - `POST /api/gateway/backlog/merge`
  - `GET /api/gateway/backlog/exec/config`
  - `GET /api/gateway/backlog/exec/requests?status=…&limit=…`
  - `GET /api/gateway/backlog/exec/requests/{request_id}?include_prompt=true|false`
  - `POST /api/gateway/backlog/exec/requests/{request_id}/feedback`
  - `POST /api/gateway/backlog/exec/requests/{request_id}/promote`
  - `POST /api/gateway/backlog/exec/requests/{request_id}/uat/deploy`
  - `GET /api/gateway/backlog/exec/requests/{request_id}/logs/tail?name=…&max_bytes=…`
  - `GET /api/gateway/backlog/exec/active_items?status=…&limit=…`
  - `POST /api/gateway/backlog/{kind}/{filename}/attachments/upload`
  - `POST /api/gateway/backlog/assist`
  - `POST /api/gateway/backlog/maintain`
  - `POST /api/gateway/backlog/advisor`

## See also
- Getting started: `getting-started.md`
- Architecture: `architecture.md`
- Configuration & deployment: `configuration.md`
- Security & trust boundaries: `security.md`

---

## docs/configuration.md

# Configuration & deployment

This project has two layers of configuration:
1) the **static UI server** (Node.js CLI); and
2) the **browser UI settings** (stored locally in your browser).

## CLI (static server)
Implemented in `bin/cli.js`.

- `PORT` — HTTP port to listen on (default `3001`)
- `HOST` — bind address (default `0.0.0.0`)
- `--monitor-gpu` or `ABSTRACTOBSERVER_MONITOR_GPU=1|true|yes|on` — injects `window.__ABSTRACT_UI_CONFIG__.monitor_gpu=true` to enable the GPU widget in the UI (`src/ui/app.tsx`)

Examples:
```bash
PORT=8080 abstractobserver
HOST=127.0.0.1 PORT=3001 abstractobserver
abstractobserver --monitor-gpu
```

## Browser UI settings (per device/browser)
Implemented in `src/ui/app.tsx` (see `load_settings()` / `save_settings()`).

- **Gateway URL** (`gateway_url`)
  - Blank means **same-origin** (calls `/api/...` on the same host serving the UI).
  - Set it to `http(s)://…` to target a remote gateway.
  - Note: the packaged CLI (`bin/cli.js`) serves static files only. If you leave Gateway URL blank when using the CLI, `/api` must be provided by a reverse proxy.
- **Auth token** (`auth_token`) — sent as `Authorization: Bearer …` to the gateway (see `src/lib/gateway_client.ts`).
- **Remote tool worker** (`worker_url`, `worker_token`) — optional MCP JSON-RPC over HTTP endpoint used to execute tool waits (see `src/lib/mcp_worker_client.ts`).
- UI preferences: theme, font scale, header density, auto-connect.

## Deployment patterns (recommended)
### 1) Same-origin (simplest)
Serve the UI and gateway under the same origin, and keep **Gateway URL blank**.
- Pros: no CORS issues; works well behind a reverse proxy.
- Cons: requires routing `/api` to the gateway.

### 2) Cross-origin (gateway on a different host)
Set **Gateway URL** in the UI settings.
- The gateway must allow browser access (CORS, auth, TLS).
- Avoid `http://localhost:…` when accessing from another device; the UI explicitly warns about this in discovery logic (`on_discover_gateway()` in `src/ui/app.tsx`).

## Dev server proxy
In dev (`npm run dev`), Vite proxies `/api` to `http://localhost:8081` by default (see `vite.config.ts`).
If your gateway is elsewhere, update the `server.proxy` section.

## PWA / service worker
- Production builds register a service worker at `/sw.js` to cache the UI shell (see `src/main.tsx` and `public/sw.js`).
- In dev, the app **unregisters** any existing service workers and clears caches to avoid “stale UI” behavior (see `src/main.tsx`).

## See also
- Getting started: `getting-started.md`
- API endpoints used by the UI: `gateway-api.md`
- Security & trust boundaries: `security.md`
- Development: `development.md`

---

## docs/security.md

# Security & trust boundaries

AbstractObserver is “just a UI”, but it can become **high-trust** depending on what your gateway exposes and which optional features you enable.

## Network exposure (CLI default bind)
The packaged CLI binds to `0.0.0.0` by default (`HOST` in `bin/cli.js`), which can expose the UI on your LAN.

Guidance:
- Prefer `HOST=127.0.0.1` for local development.
- For shared deployments, put the UI behind an authenticated reverse proxy and use HTTPS.

## Tokens and local storage
The UI stores settings in your browser (see `load_settings()` / `save_settings()` in `src/ui/app.tsx`), including:
- gateway auth token (`auth_token`)
- optional MCP worker auth token (`worker_token`)

Operational guidance:
- Treat the browser profile as a secret-bearing environment.
- Prefer private machines and locked-down profiles for production tokens.
- Prefer same-origin deployments and HTTPS to reduce leakage risk.

## Process manager (high trust)
The **Processes** page (`src/ui/processes_page.tsx`) can call endpoints that start/stop/restart/redeploy services and tail logs.

Guidance:
- Do not expose process-manager endpoints on a public gateway.
- Enforce strong authn/authz and network restrictions.
- Assume “whoever can access the UI + token can control processes”.

## Remote tool worker (high trust)
If configured, AbstractObserver can execute tool waits via an MCP HTTP worker (`src/lib/mcp_worker_client.ts`) and then resume the run via `POST /api/gateway/commands` (`src/lib/gateway_client.ts`).

Guidance:
- Only point to trusted workers (they can run tools on your behalf).
- Use per-environment tokens and audit logs where possible.
- Prefer running the worker on the same machine/network as the user controlling it.

## Cross-origin + CORS
If the UI origin differs from the gateway origin:
- the gateway must support browser access (CORS, TLS, auth)
- tokens will be sent from the browser to the gateway (and potentially exposed to browser extensions)

Guidance:
- Prefer a reverse proxy so the UI and gateway are same-origin (`configuration.md`).
- If CORS is required, restrict origins and headers; avoid permissive wildcards.

## See also
- Getting started: `getting-started.md`
- Configuration & deployment: `configuration.md`
- Gateway API contract: `gateway-api.md`
- Architecture: `architecture.md`

---

## docs/development.md

# Development

## Prerequisites
- Node.js `>=18` (see `package.json#engines`)
- npm

## Run from source (local dev)
```bash
npm install
npm run dev
```

### Workspace dependencies (important)
The UI imports several “AbstractUIC” packages (examples in `src/ui/app.tsx`) and `vite.config.ts` aliases them to local source paths like `../abstractuic/*/src`.

That means `npm run dev` / `npm run build` expect the following to exist **next to** this repo:
- `../abstractuic/monitor-active-memory/src`
- `../abstractuic/monitor-flow/src`
- `../abstractuic/panel-chat/src`
- `../abstractuic/ui-kit/src`
- `../abstractuic/monitor-gpu/src`

If you only cloned `abstractobserver`, you have two options:
1) check out the required sibling repos under `../abstractuic`, or
2) replace the Vite aliases and add proper package dependencies (if/when those packages are published).

## Tests
```bash
npm test
```

Test suite is Vitest (see `vitest.config.cjs`) with unit tests under `src/**.test.ts(x)`.

## Build
```bash
npm run build
```

- Builds the SPA into `dist/` (Vite) and type-checks via `tsc`.
- The published CLI serves `dist/` (see `bin/cli.js`).
- `npm publish` runs `npm run build` via `prepublishOnly` (see `package.json`).

## Useful scripts
- `npm run dev` — Vite dev server (defaults to port `3001`; proxies `/api` to `http://localhost:8081` per `vite.config.ts`)
- `npm run preview` — preview the production build
- `npm test` — run unit tests

## See also
- Getting started: `getting-started.md`
- Configuration & deployment: `configuration.md`
- Architecture: `architecture.md`
- Security & trust boundaries: `security.md`

---

## docs/troubleshooting.md

# Troubleshooting

## “Gateway URL must start with http:// or https://”
In Settings → Gateway URL, use an absolute URL (including scheme), or leave it blank for same-origin `/api` calls.

Evidence: `on_discover_gateway()` in `src/ui/app.tsx`.

## “Mixed content is blocked” (https page → http gateway)
Browsers block `https://` pages from calling `http://` APIs.
- Use an `https://` gateway URL, or
- deploy UI + gateway behind the same `https://` origin (reverse proxy) and leave Gateway URL blank.

Evidence: mixed-content guard in `on_discover_gateway()` in `src/ui/app.tsx`.

## “Gateway URL points to localhost … from this device is not your machine”
If you opened the UI from another device (phone, tablet), `localhost` refers to that device, not your gateway host.
- Use the gateway’s LAN/public URL, or
- use a tunnel (HTTPS) to your local gateway, or
- keep same-origin via a reverse proxy.

Evidence: loopback guard in `on_discover_gateway()` in `src/ui/app.tsx`.

## CORS errors in the browser console
Use same-origin deployment (recommended) or configure CORS on the gateway for your UI origin.
See `configuration.md`.

## Blank Gateway URL + CLI server shows 404s under /api
The packaged CLI (`bin/cli.js`) is a static server and does not proxy `/api`.
- Set **Gateway URL** to your gateway base URL (e.g. `http://localhost:8081`), or
- deploy behind a reverse proxy so the UI and gateway are same-origin and `/api` routes to the gateway.

## Stale UI after updating
Production builds register a service worker (`src/main.tsx`, `public/sw.js`).
If you see stale UI assets:
- hard refresh, or
- clear site data / unregister service worker for the site.

In dev, AbstractObserver automatically unregisters service workers on load (see `src/main.tsx`).

## See also
- Getting started: `getting-started.md`
- Configuration & deployment: `configuration.md`
- Security & trust boundaries: `security.md`

---
